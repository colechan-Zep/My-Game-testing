<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>WeChat Final Diagnostic</title>
    
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
      /* 1. 關鍵：背景改回透明，唔好遮住相機 */
      html, body {
        background-color: transparent !important;
        margin: 0;
        overflow: hidden;
      }
      
      /* 2. 診斷面板：顯示相機的具體數據 */
      #debug-text {
        position: fixed;
        top: 20px; left: 20px;
        color: lime; /* 螢光綠色字 */
        background: rgba(0,0,0,0.7);
        padding: 15px;
        font-family: monospace;
        font-size: 14px;
        z-index: 999999;
        pointer-events: none;
        white-space: pre; /* 保留換行 */
      }

      /* 3. 相機影片層 */
      #arjs-video {
        z-index: -100 !important;
        display: block !important;
      }
    </style>
  </head>
  
  <body>
    <div id="debug-text">初始化系統...</div>

    <a-scene embedded 
             arjs="sourceType: webcam; debugUIEnabled: false;"
             vr-mode-ui="enabled: false"
             renderer="alpha: true; logarithmicDepthBuffer: true;">
      
      <a-marker preset="hiro">
        <a-box position="0 0.5 0" material="color: yellow; opacity: 0.8;" animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-box>
      </a-marker>
      
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      var debugText = document.getElementById('debug-text');
      
      // 每 0.5 秒檢查一次相機狀態
      setInterval(function() {
        var video = document.getElementById('arjs-video');
        
        if (video) {
          var w = video.videoWidth;
          var h = video.videoHeight;
          var state = video.readyState; // 0=無數據, 4=播放中
          
          debugText.innerHTML = 
            "相機元素: 找到\n" +
            "狀態代碼: " + state + " (目標:4)\n" +
            "解析度: " + w + " x " + h + "\n" +
            "背景透明: 是";

          // 如果狀態係 0 (無數據)，強制叫佢播放
          if (state === 0) {
             video.play().catch(function(e){ 
                console.log("Play error"); 
             });
          }
          
          // 強制樣式修正
          video.style.opacity = "1";
          video.style.zIndex = "-100";
          
        } else {
          debugText.innerHTML = "相機元素: 搜尋中...";
        }
      }, 500);
    </script>
  </body>
</html>
